{"version":3,"file":"hyperspace-3d.umd.js","sources":["../src/util/functions.js","../src/index.js","../src/style.js"],"sourcesContent":["export const calcWindowHeight = () => Math.min(document.documentElement.clientHeight, window.innerHeight);\n\nexport const calcViewBound = (element) => ({\n  top: element.offsetTop,\n  bottom: element.offsetTop + element.clientHeight,\n});\n","import { calcWindowHeight, calcViewBound } from './util/functions';\nimport createStyle from './style';\n\nconst Hyperspace3D = (options, selector = '#hs') => {\n  // Use options and build config\n  const defaultOptions = {\n    space: {\n      amount: 50, // How much the space between sections are. 1-100\n      extra: 'auto', // Space after last element. 'auto' detect if element is last, then it is false, otherwise true\n    },\n    bound: {\n      padding: 100, // Padding of bound, in pixels. This is to prevent element sticking if user scrolls away fast\n    },\n    blur: {\n      active: true,\n      amount: 10, // How much the blur is. 0-inf\n      hq: true, // This solves ClearType pixel problem, makes content hq. Unfortunately it is pretty process intense\n      offset: 0.9, // Offset for when hq kicks in\n    },\n    opacity: {\n      active: true,\n      amount: 1, // How much opacity between 0-1\n    },\n  };\n  const config = { ...defaultOptions, ...options };\n\n  // Constants & variables\n  const element = document.querySelector(selector);\n  let windowHeight = calcWindowHeight();\n  let viewBound = calcViewBound(element);\n\n  // Declare functions\n  const handleConfigAuto = () => {\n    if (config.space.extra === 'auto') {\n      // Check if element is last on page\n      if (element.offsetHeight + element.offsetTop >= document.body.offsetHeight) {\n        config.space.extra = false;\n      } else {\n        config.space.extra = true;\n      }\n    }\n  };\n\n  const handleScroll = () => {\n    const bottomOfWindow = window.pageYOffset + windowHeight;\n    const topOfWindow = window.pageYOffset;\n    if (\n      viewBound.top - config.bound.padding <= bottomOfWindow\n      && viewBound.bottom + config.bound.padding >= topOfWindow\n    ) {\n      updateScene();\n    }\n  };\n\n  const updateScene = () => {\n    const scrolledPx = window.pageYOffset - element.offsetTop;\n    const scrolledVh = scrolledPx / windowHeight;\n    const offsetValue = scrolledVh * 100;\n\n    const cameraZ = scrolledVh * 100;\n    const offsetY = offsetValue <= 0 ? offsetValue : 0;\n\n    element.style.setProperty('--cameraZ', cameraZ);\n    element.style.setProperty('--offsetY', offsetY);\n\n    const blur = scrolledVh * config.blur.amount;\n    if (config.blur.active && config.blur.amount > 0) {\n      element.style.setProperty('--blur', blur);\n    }\n    if (config.opacity.active && config.opacity.amount > 0) {\n      const opacity = scrolledVh * config.opacity.amount;\n      element.style.setProperty('--opacity', opacity);\n    }\n\n    // Do all configs that require element children loop at the same time to boost performance\n    if ((config.blur.active && config.blur.amount > 0 && config.blur.hq === true)) {\n      const { children } = element.querySelector(\n        `${selector} > *[hs=container] > *[hs=scene]`,\n      );\n      Array.from(children).forEach((child, index) => {\n        // Blur HQ\n        const blurStop = index * (config.blur.amount - config.blur.offset);\n        if (blur < blurStop) {\n          if (child.style.filter === 'none') {\n            child.style.filter = `blur( calc( (${index} * ${config.blur.amount}px) - (var(--blur) * 1px) ) )`;\n          }\n        } else {\n          child.style.filter = 'none';\n        }\n      });\n    }\n  };\n\n  const scrollToIndex = (index) => {\n    const top = element.offsetTop + (windowHeight * index);\n    window.scroll({\n      top,\n      behavior: 'smooth',\n    });\n  };\n\n  // Actions\n  handleConfigAuto();\n  createStyle(selector, config, () => {\n    viewBound = calcViewBound(element);\n  });\n\n  // Listen on scroll and dispatch one event to get everything loaded properly\n  window.addEventListener('scroll', handleScroll);\n  window.dispatchEvent(new Event('scroll'));\n\n  // Listen on events that we need to recalculate from\n  window.addEventListener('DOMContentLoaded', () => {\n    viewBound = calcViewBound(element);\n    updateScene();\n  });\n  window.addEventListener('resize', () => {\n    viewBound = calcViewBound(element);\n    windowHeight = Math.min(\n      document.documentElement.clientHeight,\n      window.innerHeight,\n    );\n  });\n};\n\nexport default Hyperspace3D;\n","const createStyle = (selector, config, callback) => {\n  createElementStyle(selector, config);\n  createCSS(selector, config, callback);\n};\n\nconst createElementStyle = (selector, config) => {\n  const element = document.querySelector(selector);\n  const { children } = element.querySelector(\n    `${selector} > *[hs=container] > *[hs=scene]`,\n  );\n\n  Array.from(children).forEach((child, index) => {\n    child.style.transform = `translateZ(calc(${index} * -100vh))`;\n    child.style.zIndex = 1000 - index;\n\n    if (config.blur.active) {\n      child.style.filter = `blur( calc( (${index} * ${config.blur.amount}px) - (var(--blur) * 1px) ) )`;\n      child.style.willChange = 'filter';\n    }\n    if (config.opacity.active) {\n      child.style.opacity = `calc( 1 + (${index} * -${config.opacity.amount}) + (var(--opacity)))`;\n    }\n  });\n\n  const height = children.length * 100;\n  const extra = config.space.extra ? config.space.amount : 0;\n  element.style.height = `calc(${height}vh + ${extra}vh)`;\n};\n\nconst createCSS = (selector, config, callback) => {\n  const css = `\n    ${selector} *{\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    ${selector}{\n        --offsetY: -100;\n        --cameraZ: 0;\n\n        opacity:1;\n        transition:opacity 0.1s;\n    }\n\n    ${selector} > *[hs=container]{\n        height: 100%;\n        width: 100%;\n        position: fixed;\n        bottom: calc(var(--offsetY) * 1%);\n        left: 0;\n        perspective: ${config.space.amount}vh;\n        perspective-origin: 50%;\n        transform: translate3d(0, 0, 0);\n    }\n\n    ${selector} > *[hs=container] > *[hs=scene]{\n        height: 100%;\n        width: 100%;\n        position: absolute;\n        top: 0;\n        transform-style: preserve-3d;\n        transform: translateZ(calc(var(--cameraZ) * 1vh));\n        will-change: transform;\n    }\n\n    ${selector} > *[hs=container] > *[hs=scene] > section{\n        width: 100vw;\n        height: 100vh;\n        position: absolute;\n        top: 0;\n        left: 0;   \n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex-direction: column;\n    }\n  `;\n\n  const styleSheet = document.createElement('style');\n  styleSheet.type = 'text/css';\n  styleSheet.innerHTML = css;\n  document.head.appendChild(styleSheet);\n  callback();\n};\n\nexport default createStyle;\n"],"names":["const","calcViewBound","element","top","offsetTop","bottom","clientHeight","options","selector","config","Object","space","amount","extra","bound","padding","blur","active","hq","offset","opacity","document","querySelector","windowHeight","Math","min","documentElement","window","innerHeight","viewBound","updateScene","scrolledVh","pageYOffset","offsetValue","offsetY","style","setProperty","Array","from","forEach","child","index","filter","offsetHeight","body","callback","children","transform","zIndex","willChange","height","length","createElementStyle","css","styleSheet","createElement","type","innerHTML","head","appendChild","createCSS","createStyle","addEventListener","bottomOfWindow","topOfWindow","dispatchEvent","Event"],"mappings":"2KAAOA,IAEMC,WAAiBC,UAC5BC,IAAKD,EAAQE,UACbC,OAAQH,EAAQE,UAAYF,EAAQI,+BCDhBC,EAASC,kBAAW,WAqBlCC,EAASC,iBAnBQ,CACrBC,MAAO,CACLC,OAAQ,GACRC,MAAO,QAETC,MAAO,CACLC,QAAS,KAEXC,KAAM,CACJC,QAAQ,EACRL,OAAQ,GACRM,IAAI,EACJC,OAAQ,IAEVC,QAAS,CACPH,QAAQ,EACRL,OAAQ,OAMNV,EAAUmB,SAASC,cAAcd,GACnCe,ED5BgCC,KAAKC,IAAIJ,SAASK,gBAAgBpB,aAAcqB,OAAOC,aC6BvFC,EAAY5B,EAAcC,GAyBxB4B,iBAEEC,GADaJ,OAAOK,YAAc9B,EAAQE,WAChBmB,EAC1BU,EAA2B,IAAbF,EAGdG,EAAUD,GAAe,EAAIA,EAAc,EAEjD/B,EAAQiC,MAAMC,YAAY,YAHG,IAAbL,GAIhB7B,EAAQiC,MAAMC,YAAY,YAAaF,OAEjClB,EAAOe,EAAatB,EAAOO,KAAKJ,UAClCH,EAAOO,KAAKC,QAAUR,EAAOO,KAAKJ,OAAS,GAC7CV,EAAQiC,MAAMC,YAAY,SAAUpB,GAElCP,EAAOW,QAAQH,QAAUR,EAAOW,QAAQR,OAAS,GAEnDV,EAAQiC,MAAMC,YAAY,YADVL,EAAatB,EAAOW,QAAQR,QAKzCH,EAAOO,KAAKC,QAAUR,EAAOO,KAAKJ,OAAS,IAAwB,IAAnBH,EAAOO,KAAKE,GAAc,OACxDhB,EAAQoB,cACxBd,sCAEL6B,MAAMC,iBAAeC,iBAASC,EAAOC,GAG/BzB,EADayB,GAAShC,EAAOO,KAAKJ,OAASH,EAAOO,KAAKG,QAE9B,SAAvBqB,EAAML,MAAMO,SACdF,EAAML,MAAMO,OAAU,gBAAeD,QAAWhC,EAAOO,6CAGzDwB,EAAML,MAAMO,OAAS,WAtDA,SAAvBjC,EAAOE,MAAME,QAGbJ,EAAOE,MAAME,QADXX,EAAQyC,aAAezC,EAAQE,WAAaiB,SAASuB,KAAKD,wBCnC/CnC,EAAUC,EAAQoC,aAKXrC,EAAUC,OAC9BP,EAAUmB,SAASC,cAAcd,KAClBN,EAAQoB,cACxBd,+CAGL6B,MAAMC,KAAKQ,GAAUP,iBAASC,EAAOC,GACnCD,EAAML,MAAMY,UAAa,mBAAkBN,gBAC3CD,EAAML,MAAMa,OAAS,IAAOP,EAExBhC,EAAOO,KAAKC,SACduB,EAAML,MAAMO,OAAU,gBAAeD,QAAWhC,EAAOO,4CACvDwB,EAAML,MAAMc,WAAa,UAEvBxC,EAAOW,QAAQH,SACjBuB,EAAML,MAAMf,QAAW,cAAaqB,SAAYhC,EAAOW,0CAM3DlB,EAAQiC,MAAMe,OAAU,QAFS,IAAlBJ,EAASK,gBACV1C,EAAOE,MAAME,MAAQJ,EAAOE,MAAMC,OAAS,UAxBzDwC,CAAmB5C,EAAUC,YA4BZD,EAAUC,EAAQoC,OAC7BQ,EAAO,SACT7C,yFAKAA,8HAQAA,oLAMiBC,EAAOE,8GAKxBH,oRAUAA,sSAaE8C,EAAajC,SAASkC,cAAc,SAC1CD,EAAWE,KAAO,WAClBF,EAAWG,UAAYJ,EACvBhC,SAASqC,KAAKC,YAAYL,GDuBxBzB,EAAY5B,EAAcC,GCtG5B0D,CAAUpD,EAAUC,GDqGpBoD,CAAYrD,EAAUC,GAKtBkB,OAAOmC,iBAAiB,wBAhEhBC,EAAiBpC,OAAOK,YAAcT,EACtCyC,EAAcrC,OAAOK,YAEzBH,EAAU1B,IAAMM,EAAOK,MAAMC,SAAWgD,GACrClC,EAAUxB,OAASI,EAAOK,MAAMC,SAAWiD,GAE9ClC,MA2DJH,OAAOsC,cAAc,IAAIC,MAAM,WAG/BvC,OAAOmC,iBAAiB,8BACtBjC,EAAY5B,EAAcC,GAC1B4B,MAEFH,OAAOmC,iBAAiB,oBACtBjC,EAAY5B,EAAcC,GAC1BqB,EAAeC,KAAKC,IAClBJ,SAASK,gBAAgBpB,aACzBqB,OAAOC"}